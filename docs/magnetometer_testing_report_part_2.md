## Magnetometer Testing Report Part 2

More data was collected with the same [Memsic MMC5983MA magnetometer](./datasheets/Memsic_09102019_MMC5983MA_Datasheet_Rev_A-1635338.pdf) at two locations on the Emma McCrary trail. This data, along with the data described in [Part 1](magnetometer_testing_report_part_1.md), was used to train and test various classification models.

Data from the top of EMT represents pretty close to a best case scenario for a magnetometer as there is little around to produce interferance and the path is narrow. Data from the bottom of EMT is more difficult as there are powerlines nearby.

### Data preprocessing

Before feeding the data to any model, it must undergo some preprocessing. I tested two methods of preprocessing which start off the same. These are `Binned FFT Products` and `Mean FFT Products`.

**Common to both methods**  
1. Subtract the mean of the channel from every channel data series to remove the DC offset.
2. Calculate the FFT of each of the `x`, `y`, and `z` channel data series.
3. Elementwise multiply the FFT results of the three channels.
4. Keep only the values representing positive frequencies below 30Hz.

**Mean FFT Products**  

5. Normalize the FFT products
6. Calculate the mean of the normalized FFT products.

**Binned FFT Products**  

5. Apply a gaussian filter to smooth the FFT products.  
6. Bin the products by frequency into 30 buckets.

`Binned FFT Products` results in 30 features for each sample while `Mean FFT Products` results in just one.

### Model training and testing

Four types of models were trained and tested for each of the preprocessing methods. In each case, all of the data samples were split into two groups with a 65:35 ratio for training:testing. The training group was used to train the model while the testing group was used to test the trained model. The split was performed randomly, but in such a way that each group has a similar ratio of `bike`:`notbike` as the full data set's ratio. The same groups were used for all models and for both preprocessing methods.

The data presented below is the confusion matrix generated by testing each of the trained models with the testing group of data samples.

#### `Binned FFT Products`

**K Nearest Neighbors Classifier** (k = 7)
|                |Bike Not Detected| Bike Detected |
|----------------|-----------------|---------------|
|Bike Not Passing|              14 |             5 |
|Bike Passing    |               6 |            20 |

**Random Forest Classifier**
|                |Bike Not Detected| Bike Detected |
|----------------|-----------------|---------------|
|Bike Not Passing|              12 |             7 |
|Bike Passing    |               5 |            21 |

**Linear Support Vector Classifier**
|                |Bike Not Detected| Bike Detected |
|----------------|-----------------|---------------|
|Bike Not Passing|              10 |             9 |
|Bike Passing    |               7 |            19 |

**Logistic Regression Classifier**
|                |Bike Not Detected| Bike Detected |
|----------------|-----------------|---------------|
|Bike Not Passing|              13 |             6 |
|Bike Passing    |               6 |            20 |

#### `Mean FFT Products`

**K Nearest Neighbors Classifier** (k = 7)
|                |Bike Not Detected| Bike Detected |
|----------------|-----------------|---------------|
|Bike Not Passing|              14 |             5 |
|Bike Passing    |               6 |            20 |

**Random Forest Classifier**
|                |Bike Not Detected| Bike Detected |
|----------------|-----------------|---------------|
|Bike Not Passing|              12 |             7 |
|Bike Passing    |               5 |            21 |

**Linear Support Vector Classifier**
|                |Bike Not Detected| Bike Detected |
|----------------|-----------------|---------------|
|Bike Not Passing|              10 |             9 |
|Bike Passing    |               3 |            23 |

**Logistic Regression Classifier**
|                |Bike Not Detected| Bike Detected |
|----------------|-----------------|---------------|
|Bike Not Passing|              10 |             9 |
|Bike Passing    |               3 |            23 |

The best results appear to come from the KNN and RFC models and there is no difference between which preprocessing method is used with each model with this dataset for these two models. Each one has approximately 75% accuracy.

Additional experimentation using only subsets of the data for training show that magnetometer data is sensitive to the environment. One model trained with data from one location will do better at that location than one trained with data from all locations. Indeed, a KNN model trained and tested at only the EMT top location had an accuracy of 93%. This underscores the importance of consistency in the environment that a magnetometer bike detector should be set up in. No interferance, and a narrow path are both very important. Multiple sensors may be able to be used to cover a wider path - further testing required.